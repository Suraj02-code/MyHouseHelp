{% extends 'base.html' %}

{% block title %}My Profile - Home Service Marketplace{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin-top: 30px;">
    <div class="card">
        <div class="card-title">
            <h2 style="text-align: center; margin-bottom: 30px;">
                üë§ My Profile
            </h2>
        </div>
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- User Information -->
            <div style="border-bottom: 2px solid #f8f9fa; padding-bottom: 30px; margin-bottom: 30px;">
                <h3 style="color: #495057; margin-bottom: 20px;">Basic Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ user_form.first_name.id_for_label }}" class="form-label">First Name *</label>
                        {{ user_form.first_name }}
                        {% if user_form.first_name.errors %}
                            <div class="text-danger">{{ user_form.first_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ user_form.last_name.id_for_label }}" class="form-label">Last Name *</label>
                        {{ user_form.last_name }}
                        {% if user_form.last_name.errors %}
                            <div class="text-danger">{{ user_form.last_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ user_form.email.id_for_label }}" class="form-label">Email Address *</label>
                    {{ user_form.email }}
                    {% if user_form.email.errors %}
                        <div class="text-danger">{{ user_form.email.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ user_form.phone_number.id_for_label }}" class="form-label">Phone Number *</label>
                    {{ user_form.phone_number }}
                    {% if user_form.phone_number.errors %}
                        <div class="text-danger">{{ user_form.phone_number.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ user_form.address.id_for_label }}" class="form-label">Address *</label>
                    {{ user_form.address }}
                    {% if user_form.address.errors %}
                        <div class="text-danger">{{ user_form.address.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ user_form.profile_picture.id_for_label }}" class="form-label">Profile Picture</label>
                    {{ user_form.profile_picture }}
                    {% if user.profile_picture %}
                        <div style="margin-top: 10px;">
                            <small class="text-muted">Current picture:</small><br>
                            <img src="{{ user.profile_picture.url }}" alt="Profile Picture" 
                                 style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-top: 5px;">
                        </div>
                    {% endif %}
                    {% if user_form.profile_picture.errors %}
                        <div class="text-danger">{{ user_form.profile_picture.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Role-specific Information -->
            {% if profile_form %}
                <div style="padding-bottom: 30px; margin-bottom: 30px;">
                    {% if user.role == 'customer' %}
                        <h3 style="color: #495057; margin-bottom: 20px;">üè† Customer Preferences</h3>
                        
                        <div class="form-group">
                            <label for="{{ profile_form.preferred_services.id_for_label }}" class="form-label">Preferred Services</label>
                            {{ profile_form.preferred_services }}
                            {% if profile_form.preferred_services.help_text %}
                                <small class="text-muted">{{ profile_form.preferred_services.help_text }}</small>
                            {% endif %}
                            {% if profile_form.preferred_services.errors %}
                                <div class="text-danger">{{ profile_form.preferred_services.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                    {% elif user.role == 'provider' %}
                        <h3 style="color: #495057; margin-bottom: 20px;">üè¢ Business Information</h3>
                        
                        <div class="form-group">
                            <label for="{{ profile_form.business_name.id_for_label }}" class="form-label">Business Name *</label>
                            {{ profile_form.business_name }}
                            {% if profile_form.business_name.help_text %}
                                <small class="text-muted">{{ profile_form.business_name.help_text }}</small>
                            {% endif %}
                            {% if profile_form.business_name.errors %}
                                <div class="text-danger">{{ profile_form.business_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            <label for="{{ profile_form.business_license.id_for_label }}" class="form-label">Business License</label>
                            {{ profile_form.business_license }}
                            {% if profile_form.business_license.help_text %}
                                <small class="text-muted">{{ profile_form.business_license.help_text }}</small>
                            {% endif %}
                            {% if profile_form.business_license.errors %}
                                <div class="text-danger">{{ profile_form.business_license.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            <label for="{{ profile_form.description.id_for_label }}" class="form-label">Business Description *</label>
                            {{ profile_form.description }}
                            {% if profile_form.description.help_text %}
                                <small class="text-muted">{{ profile_form.description.help_text }}</small>
                            {% endif %}
                            {% if profile_form.description.errors %}
                                <div class="text-danger">{{ profile_form.description.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="{{ profile_form.years_of_experience.id_for_label }}" class="form-label">Years of Experience *</label>
                                {{ profile_form.years_of_experience }}
                                {% if profile_form.years_of_experience.help_text %}
                                    <small class="text-muted">{{ profile_form.years_of_experience.help_text }}</small>
                                {% endif %}
                                {% if profile_form.years_of_experience.errors %}
                                    <div class="text-danger">{{ profile_form.years_of_experience.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="form-group">
                                <label for="{{ profile_form.service_radius.id_for_label }}" class="form-label">Service Radius (km) *</label>
                                {{ profile_form.service_radius }}
                                {% if profile_form.service_radius.help_text %}
                                    <small class="text-muted">{{ profile_form.service_radius.help_text }}</small>
                                {% endif %}
                                {% if profile_form.service_radius.errors %}
                                    <div class="text-danger">{{ profile_form.service_radius.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="{{ profile_form.verification_documents.id_for_label }}" class="form-label">Verification Documents</label>
                            {{ profile_form.verification_documents }}
                            {% if profile_form.verification_documents.help_text %}
                                <small class="text-muted">{{ profile_form.verification_documents.help_text }}</small>
                            {% endif %}
                            {% if profile_form.verification_documents.errors %}
                                <div class="text-danger">{{ profile_form.verification_documents.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                {{ profile_form.is_available }}
                                <label for="{{ profile_form.is_available.id_for_label }}" class="form-label" style="margin: 0;">
                                    Available for new bookings
                                </label>
                            </div>
                            {% if profile_form.is_available.errors %}
                                <div class="text-danger">{{ profile_form.is_available.errors.0 }}</div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% endif %}
            
            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" class="btn btn-primary" style="padding: 12px 40px; font-size: 16px; margin-right: 15px;">
                    Save Changes
                </button>
                <a href="{% if user.role == 'customer' %}{% url 'accounts:customer_dashboard' %}{% elif user.role == 'provider' %}{% url 'accounts:provider_dashboard' %}{% else %}{% url 'home' %}{% endif %}" 
                   class="btn btn-outline-secondary" style="padding: 12px 40px; font-size: 16px;">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
    .text-danger {
        color: #dc3545 !important;
        font-size: 14px;
        margin-top: 5px;
    }
    .text-muted {
        color: #6c757d !important;
        font-size: 13px;
        margin-top: 3px;
        display: block;
    }
    .form-check-input {
        width: 20px;
        height: 20px;
    }
</style>
{% endblock %}